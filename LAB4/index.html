<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ì¸í”„ë° ì˜í™” ì •ë³´ ì‚¬ì´íŠ¸</title>
  <link rel="stylesheet" href="main.css">
</head>
<body>
  <div class="container">
    <header>
      <h1 id="header-text">ì¸í”„ë° ì˜í™” ì •ë³´ ì‚¬ì´íŠ¸ì…ë‹ˆë‹¤.</h1>
      <nav class="nav-bar">
        <a href="index.html" class="active">ë©”ì¸í˜ì´ì§€</a>
        <a href="login.html">ë¡œê·¸ì¸</a>
        <a href="signup.html">íšŒì›ê°€ì…</a>
      </nav>
      <hr>
    </header>

    <!-- ê²€ìƒ‰ ë°” -->
    <section class="filter-bar">
      <input type="text" id="search-input" placeholder="í‚¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”.">
      <button id="filter-btn">Filter results</button>
    </section>

    <!-- ì •ë ¬ ì˜µì…˜ + ì˜í™” ê·¸ë¦¬ë“œ -->
    <div class="content">
      <aside class="sort-options">
        <h3>ì •ë ¬ ê¸°ì¤€</h3>
        <label><input type="radio" name="sort" value="vote_desc" checked> í‰ì  ë‚´ë¦¼ì°¨ìˆœ</label>
        <label><input type="radio" name="sort" value="vote_asc"> í‰ì  ì˜¤ë¦„ì°¨ìˆœ</label>
        <label><input type="radio" name="sort" value="date_desc"> ê°œë´‰ ë‚´ë¦¼ì°¨ìˆœ</label>
        <label><input type="radio" name="sort" value="date_asc"> ê°œë´‰ ì˜¤ë¦„ì°¨ìˆœ</label>
      </aside>

      <div class="movies-grid" id="movies-grid">
        <!-- JSë¡œ ì˜í™” ì¹´ë“œê°€ ì‚½ì…ë©ë‹ˆë‹¤. -->
      </div>
      <!-- infinite scroll sentinel -->
      <div id="sentinel"></div>
    </div>
  </div>

  <script>
    let movies = [];
    const pageSize = 10;
    let currentPage = 0;
    let filtered = [];

    async function loadMovies() {
      try {
        const res = await fetch('product.json');
        movies = await res.json();
        filtered = applyFilter(movies);
        renderNextBatch();
        observeSentinel();
      } catch (e) {
        console.error('Load error:', e);
      }
    }

    function applyFilter(list) {
      const kw = document.getElementById('search-input').value.trim().toLowerCase();
      return list.filter(m =>
        (m.title || '').toLowerCase().includes(kw)
      );
    }

    function renderMovies(list, append = false) {
      const container = document.getElementById('movies-grid');
      if (!append) container.innerHTML = '';
      list.forEach(movie => {
        const card = document.createElement('div');
        card.className = 'movie-card';
        card.innerHTML = `
          <div class="movie-card__poster" tabindex="0">
            <img src="${movie.poster_path}" alt="${movie.title}">
            <div class="movie-card__overlay">
              <h4 class="overlay-title">ì¤„ê±°ë¦¬:</h4>
              <p class="overlay-text">${movie.overview}</p>
            </div>
          </div>
          <div class="movie-card__info">
            <h4>${movie.title}</h4>
            <p>ğŸ“… ${movie.release_date}</p>
            <p>â­ ${movie.vote_average}/10</p>
          </div>
        `;
        container.appendChild(card);
      });
    }

    function renderNextBatch() {
      const start = currentPage * pageSize;
      const nextBatch = filtered.slice(start, start + pageSize);
      if (nextBatch.length === 0) return;
      renderMovies(nextBatch, currentPage > 0);
      currentPage++;
    }

    function filterAndReset() {
      // ê²€ìƒ‰/ì •ë ¬ ë²„íŠ¼ ëˆŒë €ì„ ë•Œ
      filtered = applyFilter(movies);
      currentPage = 0;
      renderNextBatch();
    }

    document.getElementById('filter-btn').addEventListener('click', filterAndReset);
    document.querySelectorAll('input[name="sort"]').forEach(r =>
      r.addEventListener('change', filterAndReset)
    );

    function observeSentinel() {
      const sentinel = document.getElementById('sentinel');
      const io = new IntersectionObserver(entries => {
        if (entries[0].isIntersecting) {
          renderNextBatch();
        }
      }, {
        rootMargin: '0px 0px 200px 0px'
      });
      io.observe(sentinel);

      window.addEventListener('scroll', () => {
        const scrollPos = window.innerHeight + window.pageYOffset;
        const threshold = document.documentElement.scrollHeight - 100;
        if (scrollPos >= threshold) {
          renderNextBatch();
        }
      });
    }

    document.addEventListener('DOMContentLoaded', loadMovies);
  </script>
</body>
</html>
